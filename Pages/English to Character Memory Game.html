<html>
<head>
<title>English and Characters</title>
<link rel = "stylesheet" type = "text/css" href = "../CSS/Memory Games.css"></link>

<h1>English and Characters Memory Game</h1>

<input class="MemoryBack" onClick="window.location.href = '6) Memory Game Menu.html'" type="button" value="Back"/>

<script>

// Characters need to be stored in their unicode representation. 
var ni = '\u4F60';
var nin = '\u60A8';
var hao = '\u597D';
var wo = '\u6211';
var hen = '\u5F88';
var ma = '\u5417'; 

var charList = [ni, nin, hao, wo, hen, ma];
var wordList = ['You', 'You (Polite)', 'Good', 'I, me', 'Very', 'Interrogative word'];
var gameTiles = charList.concat(wordList);
var tilesSelected = []; 

// An array that will contain memory tile IDs that the user selects.
var memory_tile_ids = [];  

var totalTilesFlipped = 0;

// Method to shuffle the tiles. The code was found through research on the internet.
Array.prototype.shuffle_tiles = function() {
    var i = this.length, j, temp;
    while (--i > 0) {
        j = Math.floor(Math.random() * (i + 1));
        temp = this[j];
        this[j] = this[i];
        this[i] = temp;
    }
}

// Generates a new board.
function newBoard() {
	totalTilesFlipped = 0;
	var tiles_generated = '';
    gameTiles.shuffle_tiles(); 
	
	// Add each tile onto the page with the functionality.
	for (var i = 0; i < gameTiles.length; i++) {
		// When a tile is clicked on, run the flipTile method.
		tiles_generated  += "<div id = 'tile_" + i + "' onclick = 'flipTile(this,\"" + gameTiles[i] + "\")'></div>";
	}   
	
	// Show the tiles on the page.
	document.getElementById('memory_board').innerHTML = tiles_generated;
}

// Performs the actions involved when flipping a single tile.
function flipTile(tile, value) {
	// If the tile is unflipped and a pair of tiles haven't been selected yet.
	if (tile.innerHTML == "" && tilesSelected.length < 2) {
		// Display the tile value.
		tile.style.background = 'White';
		tile.innerHTML = value;
		
		// Check the current number of active tiles flipped.
		switch (tilesSelected.length) {
			// If it's the first tile (of the pair) that was flipped.
			case 0:
				// Retrieve the tile's information.
				var indexSelected = getItemPosition(value);
				tilesSelected.push(indexSelected);
				memory_tile_ids.push(tile.id);
				break;
			// If a tile was already flipped (2 tiles have been flipped at this point).
			case 1:
				var indexSelected = getItemPosition(value);
				tilesSelected.push(indexSelected);
				memory_tile_ids.push(tile.id);

				// Check if the tile values' indexes match (from their respective arrays).
				// In other words, if the tiles match.
				if (tilesSelected[0] == tilesSelected[1]) {
					// Increment the total tile flipped and clear the local storage
					// of both selected tiles (for the next tiles to be selected).
					totalTilesFlipped += 2;
					tilesSelected = [];
					memory_tile_ids = [];

					// Generate a new board once all the tiles have been flipped.
					if (totalTilesFlipped == gameTiles.length) {
						alert("Board cleared... generating new board");
						document.getElementById('memory_board').innerHTML = "";               
						newBoard();
					}
					// Flip the tiles back if they don't match.
				} else {
					// The time it takes for the cards to flip back over.
					setTimeout(flip_tiles_Back, 700);
				}
				break;
		}
	}
}

// Flip the 2 tiles back over
function flip_tiles_Back() {
	// Get the IDs of the tiles, then clear them.
	var tile_1 = document.getElementById(memory_tile_ids[0]);
	var tile_2 = document.getElementById(memory_tile_ids[1]);  
					
    tile_1.innerHTML = "";
    tile_2.innerHTML = "";
	tilesSelected = [];
    memory_tile_ids = [];
}

// Gets the tile value's index in its respective array.
function getItemPosition(tileValue) {
	var index = charList.indexOf(tileValue);
	if (index < 0) {
		index = wordList.indexOf(tileValue);
	}
	return index;
}
</script>
</head>
<body>
<!-- Just like the boxes in the sentence pages. The ‘div’ tags will act as a section of the HTML page and CSS will be used to create the memory board. -->
<div id="memory_board"></div>

<!-- The function ‘newBoard’ is called here. This will mean that the function will run when the page opens on 
     the web browser otherwise the code in the functions will not run at all. -->
<script>newBoard();</script>
</body>
</html>