<html>
<head>
	<title> Test </title>
	<link rel = "stylesheet" type = "text/css" href = "../CSS/Test Page.css"></link>
</head>

<body>
	<div>
		<!--'test_status' is the ID for header 1. JavaScript code later on will be used to retrieve the header by ID and change the contents.-->
		<h1 id="test_status">Chinese Mandarin Test</h1>

		<!--The code above defines a section of the page with an ID of 'test' which will be the space that the test questions will be displayed.
			CSS will be used to create the box for the space.-->
		<div id="test"></div>

		<!--This is the back button for the test page which is given a class of 'TestBack'.-->
		<br><input class="TestBack" onClick="window.location.href = '5) Assessment Page.html'" type="button" value="Quit Test"/>

	</div>

<script>
// The function above is the shuffle method that will be used to shuffle the items in the arrays.
// This function generates a number between 0 and 1, then it's rounded to the nearest whole number meaning that the only possible results are 0 or 1.
// The result generated will be subtracted by 0.5 meaning that the function will either return -0.5 or 0.5.
function randOrd() {
	return (Math.round(Math.random())-0.5);
}

// The function 'getItem' will be used to retrieve certain HTML items by ID. The parameter 'x' represents the name of the HTML value to be retrieved by ID.
// For example: 'var test = getItem("test")' will equate the 'test' div from the HTML to the variable 'test'. This will allow the div to be modified by using JavaScript code.
// Later on in the code, items will be added into the 'test' div with JavaScript.
function getItem(x) {
	return document.getElementById(x);
}

// The characters that will be used for the questions are stored in their own variables in order for them to be
// easily added into and recognised throughout the code. The variables can be put into a single line, but it's easier to read when all of the
// variables have values set.
var ni = '\u4F60';
var nin = '\u60A8';
var hao = '\u597D';
var wo = '\u6211';
var hen = '\u5F88';
var ma = '\u5417';

//'questionsAnswered' will represent the number of questions that have been answered and it will be used as an index to
// locate the values in the 'questionOrder' array for the variable 'questionOrderIndex' to use.
var questionsAnswered = 0;

//'questionOrderIndex' will represent the index of the question order which will be used to locate the next question for the test.
// The question list that contains the questions are not randomised, but the values of 'questionOrder' will be randomised meaning
// that the questions will be displayed in a random order.
var questionOrderIndex = 0;

// 'total' will represent the total number of questions that have been asked.
var total = 0;
var correct = 0;

// 'questionSet1' stores the first type of questions that the user can receive in the test.
// This is a 2-D array because it's an array that will hold other arrays that
// will have the question and possible answers. The questions require the user to translate sentences.
var questionSet1 = [
    [ "Translate: \u4F60\u597D ", ["hello", "hi"]],
    [ "Translate: \u4F60\u597D\u5417?", ["how are you?", "how are you"]],
    [ "Translate: \u6211\u5F88\u597D", ["i'm good", "i'm fine", "i am good", "i am fine"]],

];

// 'questionSet2' stores the second type of questions that the user can receive. This is also a 2-D array
// with questions that require the user to translate single characters.
var questionSet2 = [
    [ "Translate: \u4F60", ["you"]],
    [ "Translate: \u60A8", ["you (polite version)", "you"]],
    [ "Translate: \u597D", ["good, fine", "good", "fine"]],
	[ "Translate: \u6211", ["i, me", "i", "me"]],
	[ "Translate: \u5F88", ["very"]],
	[ "Translate: \u5417", ["interrogative word (used at the end of a statement to form a question)", "interrogative word"]],
];

// 'questionSet3' stores the third type of questions that the user can receive. This is also a 2-D array with questions that require the user to select
// a character or word matching with the word or charcter that is displayed. The last element of each question array holds the letter to the answer.
var questionSet3 = [
	[ "Select the word matching: \u4F60", "You", "You (Polite Version)", "You", "I, me", "Very", "Interrogative word (used at the end of a statement to form a question)", "Good, fine", "B" ],
    [ "Select the word matching: \u60A8", "You (Polite Version)", "I, me", "Interrogative word (used at the end of a statement to form a question)", "You", "You (Polite Version)", "Good, fine", "Very", "D" ],
    [ "Select the word matching: \u597D", "Good, fine", "You (Polite Version)", "Very", "Good, fine", "I, me", "Interrogative word (used at the end of a statement to form a question)", "You", "C" ],
	[ "Select the word matching:\u6211", "I, me", "Very", "You", "Good, fine", "Interrogative word (used at the end of a statement to form a question)", "I, me", "You (Polite Version)", "E" ],
	[ "Select the word matching: \u5F88", "Very", "Very", "Good, fine", "Interrogative word (used at the end of a statement to form a question)", "You", "I, me", "You (Polite Version)", "A" ],
	[ "Select the word matching: \u5417", "Interrogative word (used at the end of a statement to form a question)", "You (Polite Version)", "Good, fine", "You", "I, me", "Very", "Interrogative word (used at the end of a statement to form a question)", "F" ],
    [ "Select the character matching: You", ni, wo, ni, nin, hao, ma, hen, "B" ],
	[ "Select the character matching: You (Polite Version)", nin, nin, hen, wo, ma, ni, hao, "A" ],
	[ "Select the character matching: Good, fine", hao, ma, hao, nin, ni, hen, wo, "B" ],
	[ "Select the character matching: I, me", wo, hen, nin, ni, hao, ma, wo, "F" ],
	[ "Select the character matching: Very", hen, hao, wo, ma, hen, ni, nin, "D" ],
	[ "Select the character matching: Interrogative word (used at the end of a statement to form a question)", ma, ni, hao, ma, hen, wo, nin, "C" ],
];

// This is a blank array that will contain the questions that the user will receive for the test.
var questions = [];
const NUM_OF_QUESTIONS = 10;

// All the question sets are randomised in order to prevent the user from recieving exactly the same questions on each test.
// 'randOrd' is a function that is used as the shuffle method for array items. The 'randOrd' function returns a number
// that is equally likely to be either negative or positive meaning that a random order will occur when 'sort()' is used.
questionSet1.sort(randOrd);
questionSet2.sort(randOrd);
questionSet3.sort(randOrd);

// This 'FOR' loop will add the questions from the question lists into the 'questions' array until there are 10 items (questions) in the array.
// 'i' will represent the question number for each list. The maximum value that 'i' will be is 2 because there are only 3 questions minimum from 'questionSet1'.
for (var i = 0; questions.length < NUM_OF_QUESTIONS; i++) {

	// This will only apply if there are 9 questions in the 'questions' array.
	if (questions.length == 9) {
		// A question from 'questionSet2' will be added to the 'questions' array, but this means that
		// there will be more questions from 'questionSet2' than any of the other questions.
		questions.push(questionSet2[i]);

	// If there are less than 9 questions in total, one question from each of teh question sets will be added into the 'questions' array.
	} else {
		questions.push(questionSet1[i]);
		questions.push(questionSet2[i]);
		questions.push(questionSet3[i]);
	}
}

// This global array will hold numbers which will represent the order that the questions will be displayed.
var questionOrder = [];

function setQuestionOrder() {
  for (var i = 0; i < NUM_OF_QUESTIONS; i++) {
      questionOrder.push(i);
  }

  // When the 'FOR' loop has been executed, the 'questionOrder' array will be randomised. This will mean that the questions will display in a random order.
  questionOrder.sort(randOrd);
  questionsAnswered = 0;
  questionOrderIndex = questionOrder[questionsAnswered];
}

// This array will hold each of the questions the user recieves through a test. This will be used to display the questions on a table at the end of the test.
var userQuestion = [];

// This array will hold the user's answer that they inputted for each question.
var userAnswer = [];

// This array will hold if the user was correct or not on a question.
var questionStatus = [];

// This function will display all the questions, user's answers and an example correct answer from the test the user has done.
function showResults() {
	// The variable 'table' is equated to a created element called 'table'. This will have HTML properities meaning that a table can be created.
	var table = document.createElement('table');
	
	// This will display a border around the whole table that will be created.
	table.style.border = "solid";
	
	// Add a row for each question.
	for (var i = 0; i < (NUM_OF_QUESTIONS + 1); i++) {
		var row = table.insertRow(i);
		
		// Insert the columns for the row.
		var colQuestion = row.insertCell(0);
		var colUserAnswer = row.insertCell(1);
		var colCorrectAnswer = row.insertCell(2);
		
		// Ajust the cell boarders.
		colQuestion.style.border = "solid";
		colUserAnswer.style.border = "solid";
		colCorrectAnswer.style.border = "solid";
		
		// If it's the top row (headers).
		if (i == 0) {
			// Set the headers in the cells.
			colQuestion.innerHTML = '<b> Question </b>';
			colUserAnswer.innerHTML = '<b> Your Answer </b>';
			colCorrectAnswer.innerHTML = '<b> Correct Answer </b>';
		// Otherwise, insert the questions, user input and answers.
		} else {
			colQuestion.innerHTML = userQuestion[i - 1][0];
			colUserAnswer.innerHTML = userAnswer[i - 1];
			
			// If it's a translate question, then only show one correct answer.
			if (userQuestion[i - 1][0].indexOf("Translate:") >= 0) {
				colCorrectAnswer.innerHTML = userQuestion[i - 1][1][0];
			} else {
				colCorrectAnswer.innerHTML = userQuestion[i - 1][1];
			}
			
			// Colour the cell based on the user's answer.
			// Colour it green if it was correct.
			if (questionStatus[i - 1] == "Correct") {
				colUserAnswer.style.border += "#008000";
			// Otherwise, colour it red (for incorrect).
			} else {
				colUserAnswer.style.border += "#FF0000";
			}
		}
	}

	// The table will be inserted into the test 'div' which will mean that the test 'div' will be equated to a variable.
	var test = document.getElementById('test');

	// The user's score is still shown when the user accesses their results.
	test.innerHTML = "<h2>You got " + correct + " of " + NUM_OF_QUESTIONS + " questions correct</h2>";

	// Show text to help the user understand what's shown/highlighted on the table.
	test.innerHTML += "<h5>The answers you entered that are highlighted <span style ='color:#008000'> GREEN </span> are CORRECT. " +
					  "The answers highlighted in <span style ='color:#FF0000'> RED </span> are INCORRECT.</h5>"
	
	// The table created will be appended (added) into the test 'div'. This will display the table.
	test.appendChild(table);
	
	// The 'Re-Test' button is shown on the results page. '<br>' will space the button from the table.
	test.innerHTML += '<br><button onclick="location.reload()">Re-Test</a>';
}

// The function 'renderResults' displays the test results to the user, showing them how they did.
function renderResults() {
	// The 'test' div is retrieved by ID (from the 'getItem' function created) and is stored in a variable called 'test'.
  	var test = getItem("test");

	// The 'test' div is equated to the user's test results and it replaces any current 'test' div contents.
  	test.innerHTML = "<h2>You got " + correct + " of " + NUM_OF_QUESTIONS +" questions correct</h2>";

	// This displays a button that will lead to the 'results' function. This will lead to a function that will display the user's test results in a table.
	// When the button is shown to the user, it will have the text 'View Results'.
  	getItem("test_status").innerHTML = "Test Completed";
	test.innerHTML += '<button onclick="showResults()">View Results</a>';

	// A button displayed as 'Re-test' will be inputted into the 'test' div. Clicking the button will result in the page in loading again.
  	// 'location.reload()' will reload the current page which is the test page.
  	test.innerHTML += '<br><br><button onclick="location.reload()">Re-test</a> ';
}

//This function will lead to code that will display the question number that the user is on, the current
// percentage of correct answers from the user (this will only show after answering the first question) and
// displaying how the questions will be laid out on the screen).
function renderQuestion() {
	// The question be selected from 'questions' array by searching the 2-D list. 'questionOrderIndex' is
	// the location of the array that holds the question with it's options and the index next to 'questionOrderIndex'
	// holds the first element of the array that holds the question. For this specific variable, 'question' will
	// hold the question which will be displayed on the screen.
	var question = questions[questionOrderIndex][0];

	// The current question position will be displayed as the new header by using the 'getItem' function, then inputting it into
	// 'test_status' header. The current position will be the variable 'questionsAnswered' with 1 added because
	// 'questionsAnswered' will start off as '0' meaning an extra value needs to be added.
	//A question number can't start off as 0.
	var test = getItem("test");
	getItem("test_status").innerHTML = "Question " + (questionsAnswered + 1) + " of " + NUM_OF_QUESTIONS;

	// This code will run only if the user has answered at least one question. The percentage of questions the user has currently got correct in the test
	// will be added into the 'test_status' header and displayed under the current contents of the header.
	if (total != 0) {
		getItem("test_status").innerHTML += '<br>Currently: '+ (correct/total * 100).toFixed(0) + '% correct';
	}

	// This checks if specific words are in the question. For this case it's 'Select the' which will mean that the question will require a selection for the answer.
	if (question.indexOf("Select the") >= 0) {
		// Each of the selectable options are stored in variables
		var chA = questions[questionOrderIndex][2];
	    var chB = questions[questionOrderIndex][3];
	    var chC = questions[questionOrderIndex][4];
		var chD = questions[questionOrderIndex][5];
		var chE = questions[questionOrderIndex][6];
		var chF = questions[questionOrderIndex][7];

		//The question is displayed.
	    test.innerHTML = "<h3>" + question + "</h3>";

		// Each of the radio buttons are added by using 'test.innerHTML +=' which will add HTML elements into the 'test' div.
		// By using '+=', this will add to the current contents rather than replacing any contents that were added in previously.
	    test.innerHTML += "<label><input type='radio' name='choices' value='A'> " + chA + "</label><br>";

		// Each of the 'ChA' to 'ChF' variables are assigned to radio buttons which all have the name 'choices' and have
		// values set to 'A' to 'F'. The 'ChA' to 'ChF' values are shown next to the radio buttons.
	    test.innerHTML += "<label><input type='radio' name='choices' value='B'> " + chB + "</label><br>";
		test.innerHTML += "<label><input type='radio' name='choices' value='C'> " + chC + "</label><br>";
		test.innerHTML += "<label><input type='radio' name='choices' value='D'> " + chD + "</label><br>";
		test.innerHTML += "<label><input type='radio' name='choices' value='E'> " + chE + "</label><br>";
	    test.innerHTML += "<label><input type='radio' name='choices' value='F'> " + chF + "</label><br><br>";

		// This displays the submit button and when it's clicked on, the 'checkSelectAnswer()' function will run.
	    test.innerHTML += "<button onclick='checkSelectAnswer()'>Submit Answer</button>";

	// This applies if the question has the text 'Translate:'.
	} else if (question.indexOf("Translate:") >= 0) {
		test.innerHTML = "<h3>" + question + "</h3>";

		// This displays a textbox that allows the user to store the value the user types in. It has the ID 'Translate'.
		test.innerHTML += "<input type='text' id='Translate'><br><br>";

		// This is the submit button that will lead to the 'checkTranslateAnswer()' function to check the answer.
		// The answer checking process is different to the method used for the radio buttons.
		test.innerHTML += "<button onclick='checkTranslateAnswer()'>Submit Answer</button>";
	}
}

// This function will run through code that will check if the user's answer was correct or not with the radio button questions.
function checkSelectAnswer() {
	// All of the radio button choices are stored in an array and is equated to the variable 'choices'.
	// It's stored in an array because all of the radio button are named 'choices'.
	var choices = document.getElementsByName("choices");

	// This variable is set to 'false' in order to check if the user has selected an answer or not after clicking the 'Submit' button.
	var answerSelected = false;

	// Checks if the user has selected an answer (radio button).
	// Their answer will be stored if they have.
	for (var i = 0; i < choices.length; i++) {
        if (choices[i].checked) {
			// Get the user's selected answer.
			choice_selected = choices[i].value;
            answerSelected = true;
        }
    }

	// 'answerSelected' will remain 'false' if the user hasn't selected a radio button.
	if (!answerSelected) {
		// A message prompt will display the message written to let the user know that they haven't selected an answer.
        alert("Please select an answer.");

		// Returning 'false' will prevent the user progressing to the next question. This will continue until the user has clicked the 'Sumbit Button' with a selected answer.
		return false;
	}

	// This 'IF' statement compares the last element in the current question in the 'questions' list to check
	// if the answer is correct or not. This will apply if the answer submitted is correct.
	if (choice_selected == questions[questionOrderIndex][8]) {
		// The 'correct' array will increment by 1 to the current value of 'correct'
		correct++;

		// A prompt message will display to let the user know that their answer was correct.
		alert("Correct.");

		// The question the user is currently on is added into the 'userQuestion' array.
		userQuestion.push(questions[questionOrderIndex]);

		// Since the user has got the question correct, the word 'Correct' will be added into the 'questionStatus' array.
		// This is needed to compare if the user has got a question correct or not when displaying the table.
		questionStatus.push("Correct")

	// The 'else' statement will run if the answer submitted doesn't match with the correct answer.
	} else {
		// A message will display to let the user know that their answer was incorrect.
		alert("Incorrect.");
		userQuestion.push(questions[questionOrderIndex]);

		// Since the user got the question incorrect, the word 'Incorrect' will be added into the 'questionStatus' array.
		// This is needed in order to display an element on the tables appropriately.
		questionStatus.push("Incorrect");
	}
	
	// Store the user's selected answer (the character/word is stored, not the letter).
	switch (choice_selected) {
	    case "A":
		    userAnswer.push(questions[questionOrderIndex][2]);
			break;
		case "B":
			userAnswer.push(questions[questionOrderIndex][3]);
			break;
		case "C":
			userAnswer.push(questions[questionOrderIndex][4]);
			break;
		case "D":
		    userAnswer.push(questions[questionOrderIndex][5]);
			break;
		case "E":
			userAnswer.push(questions[questionOrderIndex][6]);
			break;
		case "F":
			userAnswer.push(questions[questionOrderIndex][7]);
			break;
	}

	// The 'total' variable will increment by 1. The 'total' variable will still increment by 1 if the user answers a translation question.
	total++;

	// 'questionsAnswered' increments by 1 at the end of checking an answer which will allow
	// the next question to be selected in the 'questions' array. The variable 'questionOrderIndex'
	// will get the next value of 'questionOrder' which  will be used to locate and display the next question in the 'questions' array.
	questionsAnswered++;
	questionOrderIndex = questionOrder[questionsAnswered];
	progressNextQuestion();
}

// This function runs through code that checks if the user's answer for the translation answers are correct or not.
function checkTranslateAnswer() {
	// 'Letters&Spaces' variable holds the expression that allows spaces, apostrophes, lowercase and uppercase letters.
	var lettersSpaces = /^[a-zA-Z-' ]+$/;

	// 'spacesOrNoInput' variable holds the expression that allows spaces or no inputs.
	var spacesOrNoInput = /^ *$/;

	// The answer the user typed in is retrieved by ID and it's all set to lowercase.
	var translate_answer = (document.getElementById("Translate").value).toLowerCase();

	// Throughout the next following 'IF' statements, the answer the user inputted will be compared with the
	// rest of the items in the list of the question. This is because each word/character has a different number of possible translations
	// to each other.
	if (questions[questionOrderIndex][1].includes(translate_answer)) {
		correct++;
		alert("Correct.");

		// The user's current question on the test will be added into the 'userQuestion' array.
		userQuestion.push(questions[questionOrderIndex]);

		// The user's inputted answer will be added into the 'userAnswer' array.
		userAnswer.push(translate_answer);
		questionStatus.push("Correct");
		
	// Gets the length of the answer (translate_answer) and checks if it's greater than 70.
	} else if (translate_answer.length > 70) {
	    // The prompt will display a message to the user notifying them that they need to enter an answer that is less than 70 characters.
		alert("Please enter a suitable length answer that is less than 70 characters.")

		// 'false' prevents the user from advancing to the next question.
		return false;

	// This will occur if the user submits an answer, but it doesn't have any input or if it has spaces only.
	} else if (spacesOrNoInput.test(translate_answer)){
	    // The prompt will display a message and 'false' will return meaning that the user will be stuck on the page until a valid input is submitted.
		alert("Please enter an answer.")
		return false;

	// This condition will see if the contents of the variable 'translate_answer' matches with the rules of the expression.
	// This condition will only run if it returns 'false', meaning that the input doesn't meet the expression.
	} else if (!lettersSpaces.test(translate_answer)){
	    //A suitable message will display notifying the user that their answer doesn't contain letters and spaces.
		alert("Please enter a valid answer with letters and suitable spaces only.");

		//Prevents the user from advancing to the next question.
		return false;

	// This will carry out if the user's input doesn't match with the list elements meaning that the input was incorrect.
	// The prompt will display a message notfiying that the user's input was incorrect.
	} else {
		alert("Incorrect.");
		userQuestion.push(questions[questionOrderIndex]);
		userAnswer.push(translate_answer);
		questionStatus.push("Incorrect");
	}

	total++;
    questionsAnswered++;
	questionOrderIndex = questionOrder[questionsAnswered];
	progressNextQuestion();
}

// Determines the progress based on the number of questions answered.
function progressNextQuestion() {
	// Show the next question if all questions haven't been answered.
	if (questionsAnswered < NUM_OF_QUESTIONS) {
		renderQuestion();
		
	// Show the results when all questions have been answered.
	} else {
		renderResults();
	}
}

// 'window.onload' allows the functions to be called when the page is accessed in order for the code
// in the functions to run. 'setQuestionOrder()' will run first, then 'renderQuestion()' will run afterwards.
window.onload = function() {
  setQuestionOrder();
  renderQuestion();
}
</script>
</body>
</html>
