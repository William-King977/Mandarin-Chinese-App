<html>
<head>
<title>Characters and Pinyin</title>
<link rel = "stylesheet" type = "text/css" href = "../CSS/Memory Games.css"></link>

<h1>Characters and Pinyin Memory Game</h1>

<input class="MemoryBack" onClick="window.location.href = '6) Memory Game Menu.html'" type="button" value="Back"/>

<script>
var ni = '\u4F60';
var nin = '\u60A8';
var hao = '\u597D';
var wo = '\u6211';
var hen = '\u5F88';
var ma = '\u5417';

var you = 'n'+'i\u030C';
var youP = 'n'+'\xED'+'n';
var good = 'h'+'a\u030C'+'o';
var me = 'w'+'o\u030C';
var very = 'h'+'e\u030C'+'n';
var inter = 'ma';

var charList = [ni, nin, hao, wo, hen, ma];
var pinyinList = [you, youP, good, me, very, inter];
var gameTiles = charList.concat(pinyinList);
var tilesSelected = [];
var memory_tile_ids = [];
var totalTilesFlipped = 0;

Array.prototype.shuffle_tiles = function() {
    var i = this.length, j, temp;
    while (--i > 0) {
        j = Math.floor(Math.random() * (i + 1));
        temp = this[j];
        this[j] = this[i];
        this[i] = temp;
    }
}

function newBoard() {
	totalTilesFlipped = 0;
	var tiles_generated = '';
    gameTiles.shuffle_tiles();
	for (var i = 0; i < gameTiles.length; i++) {
		tiles_generated  += "<div id = 'tile_" + i + "' onclick = 'flipTile(this,\"" + gameTiles[i] + "\")'></div>";
	}
	document.getElementById('memory_board').innerHTML = tiles_generated;
}

function flipTile(tile, value) {
	if (tile.innerHTML == "" && tilesSelected.length < 2) {
		tile.style.background = 'White';
		tile.innerHTML = value;
		
		switch (tilesSelected.length) {
			case 0:
				var indexSelected = getItemPosition(value);
				tilesSelected.push(indexSelected);
				memory_tile_ids.push(tile.id);
				break;
			case 1:
				var indexSelected = getItemPosition(value);
				tilesSelected.push(indexSelected);
				memory_tile_ids.push(tile.id);
				// If the tiles match.
				if (tilesSelected[0] == tilesSelected[1]) {
					totalTilesFlipped += 2;
					tilesSelected = [];
					memory_tile_ids = [];
					if (totalTilesFlipped == gameTiles.length) {
						alert("Board cleared... generating new board");
						document.getElementById('memory_board').innerHTML = "";
						newBoard();
					}
				// Flip back the tiles if they don't match.
				} else {
					setTimeout(flip_tiles_back, 700);
				}
				break;
		}
	}
}

// Flip the tiles back.
function flip_tiles_back() {
	var tile_1 = document.getElementById(memory_tile_ids[0]);
	var tile_2 = document.getElementById(memory_tile_ids[1]);
    tile_1.innerHTML = "";
    tile_2.innerHTML = "";
	tilesSelected = [];
    memory_tile_ids = [];
}

// Gets the tile value's index in its respective array.
function getItemPosition(tileValue) {
	var index = charList.indexOf(tileValue);
	if (index < 0) {
		index = pinyinList.indexOf(tileValue);
	}
	return index;
}
</script>
</head>
<body>
<div id="memory_board"></div>
<script>newBoard();</script>
</body>
</html>